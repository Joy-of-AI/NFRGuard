# NFRGuard AI Agent Alerting Policies
# Deploy with: gcloud alpha monitoring policies create --policy-from-file=alert_policies.yaml

# High Risk Transaction Alert
- displayName: "High Risk Transactions Detected"
  documentation:
    content: "Alert when transaction risk score exceeds 0.9"
    mimeType: "text/markdown"
  conditions:
    - displayName: "High Risk Score"
      conditionThreshold:
        filter: 'metric.type="custom.googleapis.com/nfrguard/transaction_risk_agent/risk_assessment"'
        comparison: COMPARISON_GREATER_THAN
        thresholdValue: 0.9
        duration: 0s
        aggregations:
          - alignmentPeriod: 60s
            perSeriesAligner: ALIGN_RATE
            crossSeriesReducer: REDUCE_MEAN
            groupByFields:
              - "metric.labels.risk_score"
  alertStrategy:
    autoClose: 604800s  # 7 days
  notificationChannels: []  # Add your notification channels
  enabled: true

# Compliance Violation Alert
- displayName: "AUSTRAC Compliance Violations"
  documentation:
    content: "Alert when compliance checks fail"
    mimeType: "text/markdown"
  conditions:
    - displayName: "Compliance Check Failed"
      conditionThreshold:
        filter: 'metric.type="custom.googleapis.com/nfrguard/compliance_agent/compliance_check" AND metric.labels.success="0"'
        comparison: COMPARISON_GREATER_THAN
        thresholdValue: 0
        duration: 60s
        aggregations:
          - alignmentPeriod: 60s
            perSeriesAligner: ALIGN_RATE
            crossSeriesReducer: REDUCE_SUM
  alertStrategy:
    autoClose: 3600s  # 1 hour
  notificationChannels: []
  enabled: true

# Privacy Violation Alert
- displayName: "PII Violations Detected"
  documentation:
    content: "Alert when personal information is detected in logs"
    mimeType: "text/markdown"
  conditions:
    - displayName: "PII Detection"
      conditionThreshold:
        filter: 'metric.type="custom.googleapis.com/nfrguard/privacy_agent/privacy_check" AND metric.labels.pii_detected="1"'
        comparison: COMPARISON_GREATER_THAN
        thresholdValue: 0
        duration: 0s
        aggregations:
          - alignmentPeriod: 60s
            perSeriesAligner: ALIGN_RATE
            crossSeriesReducer: REDUCE_SUM
  alertStrategy:
    autoClose: 1800s  # 30 minutes
  notificationChannels: []
  enabled: true

# Negative Customer Sentiment Alert
- displayName: "Negative Customer Sentiment Spike"
  documentation:
    content: "Alert when customer sentiment turns negative"
    mimeType: "text/markdown"
  conditions:
    - displayName: "Negative Sentiment"
      conditionThreshold:
        filter: 'metric.type="custom.googleapis.com/nfrguard/sentiment_agent/sentiment_analysis" AND metric.labels.sentiment="NEGATIVE"'
        comparison: COMPARISON_GREATER_THAN
        thresholdValue: 5  # More than 5 negative sentiments in 5 minutes
        duration: 300s
        aggregations:
          - alignmentPeriod: 60s
            perSeriesAligner: ALIGN_RATE
            crossSeriesReducer: REDUCE_SUM
  alertStrategy:
    autoClose: 3600s  # 1 hour
  notificationChannels: []
  enabled: true

# High Processing Time Alert
- displayName: "AI Agent Processing Time High"
  documentation:
    content: "Alert when AI agents take too long to process"
    mimeType: "text/markdown"
  conditions:
    - displayName: "Processing Time > 5 seconds"
      conditionThreshold:
        filter: 'metric.type=~"custom.googleapis.com/nfrguard/.*/processing_time"'
        comparison: COMPARISON_GREATER_THAN
        thresholdValue: 5.0
        duration: 60s
        aggregations:
          - alignmentPeriod: 60s
            perSeriesAligner: ALIGN_MEAN
            crossSeriesReducer: REDUCE_MEAN
  alertStrategy:
    autoClose: 1800s  # 30 minutes
  notificationChannels: []
  enabled: true

# Transaction Volume Spike Alert
- displayName: "Unusual Transaction Volume"
  documentation:
    content: "Alert when transaction volume spikes significantly"
    mimeType: "text/markdown"
  conditions:
    - displayName: "Transaction Volume > 100/min"
      conditionThreshold:
        filter: 'resource.type="gke_container" AND resource.labels.cluster_name="bank-of-anthos"'
        comparison: COMPARISON_GREATER_THAN
        thresholdValue: 100
        duration: 120s
        aggregations:
          - alignmentPeriod: 60s
            perSeriesAligner: ALIGN_RATE
            crossSeriesReducer: REDUCE_SUM
  alertStrategy:
    autoClose: 3600s  # 1 hour
  notificationChannels: []
  enabled: true
